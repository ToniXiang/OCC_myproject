<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:簡易的行控中心.Converters"
             x:Class="簡易的行控中心.StationPage"
             Title="車站狀態"
             BackgroundColor="{DynamicResource PageBackgroundColor}">
    <ContentPage.Resources>
        <converters:PriorityToStringConverter x:Key="PriorityToStringConverter" />
    </ContentPage.Resources>
    <VerticalStackLayout Padding="20" Spacing="16">
        <Label Text="選擇車站:" 
               FontAttributes="Bold"
               FontSize="18"
               TextColor="{DynamicResource PrimaryTextColor}" />
        <Picker x:Name="StationPicker"
                Title="請選擇任意車站"
                TitleColor="{DynamicResource AccentColor}"
                ItemsSource="{Binding Stations}"
                SelectedItem="{Binding SelectedStation}"
                TextColor="{DynamicResource PrimaryTextColor}"
                BackgroundColor="{DynamicResource CardBackgroundColor}" />

        <!-- 車站資訊 -->
        <Frame Padding="16" CornerRadius="12" BackgroundColor="{DynamicResource CardBackgroundColor}" HasShadow="True">
            <VerticalStackLayout Spacing="8">
                <Label Text="{Binding SelectedStation.name}" 
                       FontSize="22" 
                       FontAttributes="Bold"
                       TextColor="{DynamicResource AccentColor}" />
                <HorizontalStackLayout Spacing="16">
                    <Label Text="優先序:" FontAttributes="Bold" TextColor="{DynamicResource PrimaryTextColor}" />
                    <Frame Padding="0" CornerRadius="8"
                            HasShadow="False"
                            VerticalOptions="Center"
                            BackgroundColor="{DynamicResource AccentColor}">
                        <Label Text="{Binding SelectedStation.priority, Converter={StaticResource PriorityToStringConverter}}"
                            TextColor="{DynamicResource ButtonTextColor}"
                            Padding="6,2"
                            HorizontalOptions="Center"
                            VerticalOptions="Center" />
                    </Frame>
                </HorizontalStackLayout>
                <HorizontalStackLayout Spacing="16">
                    <Label Text="月台數:" FontAttributes="Bold" TextColor="{DynamicResource PrimaryTextColor}"/>
                    <Label Text="{Binding SelectedStation.platform}" TextColor="{DynamicResource PrimaryTextColor}"/>
                </HorizontalStackLayout>
            </VerticalStackLayout>
        </Frame>

        <!-- 時刻表 -->
        <Label Text="時刻表" FontAttributes="Bold" FontSize="18" TextColor="{DynamicResource PrimaryTextColor}" />
        <CollectionView ItemsSource="{Binding Timetable}">
            <CollectionView.Header>
                <Grid ColumnDefinitions="*,*,*,*">
                    <Label Text="車次" FontAttributes="Bold" Grid.Column="0" TextColor="{DynamicResource AccentColor}" />
                    <Label Text="時間" FontAttributes="Bold" Grid.Column="1" TextColor="{DynamicResource AccentColor}" />
                    <Label Text="開往" FontAttributes="Bold" Grid.Column="2" TextColor="{DynamicResource AccentColor}" />
                    <Label Text="狀態" FontAttributes="Bold" Grid.Column="3" TextColor="{DynamicResource AccentColor}" />
                </Grid>
            </CollectionView.Header>
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Padding="10" Margin="0,4" CornerRadius="8" BackgroundColor="{DynamicResource CardBackgroundColor}">
                        <Grid ColumnDefinitions="*,*,*,*">
                            <Label Text="{Binding TrainNumber}" Grid.Column="0" TextColor="{DynamicResource PrimaryTextColor}" />
                            <Label Text="{Binding Status}" Grid.Column="1" TextColor="{DynamicResource PrimaryTextColor}" />
                            <Label Text="{Binding Destination}" Grid.Column="2" TextColor="{DynamicResource PrimaryTextColor}" />
                            <Label Text="{Binding TrainState}" Grid.Column="3" TextColor="{DynamicResource PrimaryTextColor}" />
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </VerticalStackLayout>
</ContentPage>